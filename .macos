#!/usr/bin/env bash

# Thanks to Mathias Bynens! https://mths.be/macos
# Thanks to Dries Vints

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &


## System Preferences â†’ General
# â†’ Use dark menu bar and Dock â†’ true
defaults write -g 'AppleInterfaceStyle' -string 'Dark'
# â†’ Sidebar icon size â†’ medium
defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 1


## System Preferences â†’ Desktop & Screen Saver
# â†’ Screen Saver â†’ Flurry
defaults write 'com.apple.screensaver' moduleDict -dict moduleName -string "Flurry" path -string "/System/Library/Screen Savers/Flurry.saver" type -int 0


## System Preferences â†’ Dock
# â†’ Size â†’ 48
defaults write 'com.apple.dock' 'tilesize' -int 48
# â†’ Magnification â†’ off & 64
defaults write 'com.apple.dock' 'magnification' -bool true
defaults write 'com.apple.dock' 'largesize' -int 64
# â†’ Minimize windows using â†’ Scale effect
defaults write 'com.apple.dock' 'mineffect' -string 'scale'
# â†’ Show indicators for open applications â†’ false
defaults write com.apple.dock show-process-indicators -bool false


## System Preferences â†’ Mision Control
# â†’ Automatically rearrange Spaces based on most recent use â†’ false
defaults write 'com.apple.dock' 'mru-spaces' -bool false
# â†’ Display have separate Spaces â†’ false
defaults write 'com.apple.dock' 'spans-displays' -bool false
# â†’ Dashboard â†’ false
defaults write 'com.apple.dashboard' 'mcx-disabled' -bool true
# â†’ Donâ€™t show Dashboard as a Space
defaults write 'com.apple.dock' 'dashboard-in-overlay' -bool true


## System Preferences â†’ Mision Control â†’ Hot corners...
# Possible values:
#  0: no-op
#  2: Mission Control
#  3: Show application windows
#  4: Desktop
#  5: Start screen saver
#  6: Disable screen saver
#  7: Dashboard
# 10: Put display to sleep
# 11: Launchpad
# 12: Notification Center
# â†’ Top left screen corner â†’
# defaults write 'com.apple.dock' 'wvous-tl-corner' -int 0
# defaults write 'com.apple.dock' 'wvous-tl-modifier' -int 0
# â†’ Top right screen corner â†’ Mission Control
defaults write 'com.apple.dock' 'wvous-tr-corner' -int 2
defaults write 'com.apple.dock' 'wvous-tr-modifier' -int 0
# â†’ Bottom left screen corner â†’
# defaults write 'com.apple.dock' 'wvous-bl-corner' -int 5
# defaults write 'com.apple.dock' 'wvous-bl-modifier' -int 0
# â†’ Bottom right screen corner â†’ Mission Control
defaults write 'com.apple.dock' 'wvous-br-corner' -int 2
defaults write 'com.apple.dock' 'wvous-br-modifier' -int 0


## System Preferences â†’ Language & Region
# â†’ Preferred languages â†’ en, nl
defaults write NSGlobalDomain AppleLanguages -array "en" "nl"
# â†’ Region â†’ Belgium
defaults write NSGlobalDomain AppleLocale -string "en_BE"
# -> Advanced -> Measurement units
defaults write NSGlobalDomain AppleMeasurementUnits -string "Centimeters"
defaults write NSGlobalDomain AppleMetricUnits -bool true


## System Preferences â†’ Security & Privacy
# â†’ General â†’ Require password â†’ immediately
defaults write 'com.apple.screensaver' 'askForPassword' -int 1
defaults write 'com.apple.screensaver' 'askForPasswordDelay' -int 0
# â†’ Firewall â†’ On	@todo: does this work?
sudo defaults write /Library/Preferences/com.apple.alf globalstate -int 1


## System Preferences â†’ Displays
# â†’ Show mirroring options in the menu bar when available â†’ false
defaults write 'com.apple.airplay' 'showInMenuBarIfPresent' -bool false


## System Preferences â†’ Keyboard
# â†’ Keyboard â†’ Use F1, F2, ... â†’ true
defaults write 'com.apple.keyboard.fnState' -boolean true
# â†’ Shortcuts â†’ Full Keyboard Access... â†’ All Controls
defaults write NSGlobalDomain AppleKeyboardUIMode -int 3


## System Preferences â†’ Trackpad
# â†’ Point & Click â†’ Tap to click â†’ true
defaults write 'com.apple.driver.AppleBluetoothMultitouch.trackpad' 'Clicking' -bool true
defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1


## System Preferences â†’ Sound
# â†’ Sound Effects â†’ Play user interface sound effects â†’ false
defaults write 'com.apple.systemsound' 'com.apple.sound.uiaudio.enabled' -int 0
# â†’ Sound Effects â†’ Play feedback when volume is changed â†’ false
defaults write 'com.apple.systemsound' 'com.apple.sound.beep.feedback' -int 0


## System Preferences â†’ App Store
# Check for software updates daily, not just once per week
defaults write 'com.apple.SoftwareUpdate' 'ScheduleFrequency' -int 1


## System Preferences â†’ Users & Groups
# Disable Guest access
sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool false
sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool false


## System Preferences â†’ Siri
defaults write 'com.apple.SiriNCService' 'AppleLanguages' -array "nl-BE"
defaults write 'com.apple.SiriNCService' 'AppleLocale' -string "nl_BE"


## Finder â†’ Preferences
# â†’ General â†’ Show items on desktop â†’ none
defaults write 'com.apple.finder' 'ShowHardDrivesOnDesktop' -int 0
defaults write 'com.apple.finder' 'ShowExternalHardDrivesOnDesktop' -int 0
defaults write 'com.apple.finder' 'ShowRemovableMediaOnDesktop' -int 0
defaults write 'com.apple.finder' 'ShowMountedServersOnDesktop' -int 0

# â†’ Sidebar â†’ @todo: check if this can be automated

# â†’ Advanced â†’ Show all filename extenstions â†’ true
defaults write NSGlobalDomain AppleShowAllExtensions -bool true
# â†’ Advanced â†’ Show warning before changing an extenstion â†’ false
defaults write 'com.apple.finder' 'FXEnableExtensionChangeWarning' -bool false
# â†’ Advanced â†’ When performing a search â†’ Search the Current Folder
defaults write 'com.apple.finder' 'FXDefaultSearchScope' -string "SCcf"

## Finder â†’ Other settings
# â†’ show path bar
defaults write 'com.apple.finder' 'ShowPathbar' -bool true
# â†’ show status bar
defaults write 'com.apple.finder' 'ShowStatusBar' -bool true
# â†’ allow text selection in Quick Look
defaults write 'com.apple.finder' 'QLEnableTextSelection' -bool true
# â†’ avoid creating .DS_Store files on network volumes
defaults write 'com.apple.desktopservices' 'DSDontWriteNetworkStores' -bool true
# â†’ use column view
# Possible values:
#  icnv: icons
#  clmv: columns
#  Nlsv: list
#  Flwv: coverflow
defaults write 'com.apple.finder' 'FXPreferredViewStyle' -string "clmv"
# â†’ enable snap-to-grid
/usr/libexec/PlistBuddy -c "Set :DesktopViewSettings:IconViewSettings:arrangeBy grid" $HOME/Library/Preferences/com.apple.finder.plist
/usr/libexec/PlistBuddy -c "Set :FK_StandardViewSettings:IconViewSettings:arrangeBy grid" $HOME/Library/Preferences/com.apple.finder.plist
/usr/libexec/PlistBuddy -c "Set :StandardViewSettings:IconViewSettings:arrangeBy grid" $HOME/Library/Preferences/com.apple.finder.plist
# â†’ expand "General", "Sharing & Permissions" by default
defaults write 'com.apple.finder' FXInfoPanesExpanded -dict \
    General -bool true \
    Privileges -bool true
# â†’ show the ~/Library folder
chflags nohidden $HOME/Library
# â†’ show hidden files
defaults write 'com.apple.finder' 'AppleShowAllFiles' -bool true


## Terminal â†’ Preferences
# â†’ General â†’ On startup, open â†’ Tijs
defaults write 'com.apple.terminal' 'Default Window Settings' -string "Tijs"
defaults write 'com.apple.terminal' 'Startup Window Settings' -string "Tijs"
# â†’ Encodings
defaults write 'com.apple.terminal' 'StringEncodings' -array 4
# â†’ Disable Marks, see http://apple.stackexchange.com/questions/209635/what-functionality-do-marks-offer-in-the-el-capitan-terminal
defaults write 'com.apple.terminal' 'DefaultProfilesVersion' -int 1


## Dock
# â†’ remove all app icons
defaults write 'com.apple.dock' 'persistent-apps' -array
# â†’ show only open applications
defaults write 'com.apple.dock' 'static-only' -bool true


## Calendar â†’ Preferences
# â†’ General â†’ Start week on â†’ Monday
defaults write 'com.apple.iCal' "first day of week" -int 1
# â†’ General â†’ Day starts at â†’ 09:00
defaults write 'com.apple.iCal' 'first minute of day time range' 540


## Mail
# â†’ Copy email addresses as `foo@example.com` instead of `Foo Bar <foo@example.com>` in Mail.app
#defaults write com.apple.mail AddressesIncludeNameOnPasteboard -bool false
# â†’ Disable send and reply animations
#defaults write com.apple.Mail DisableSendAnimations -bool true
#defaults write com.apple.Mail DisableReplyAnimations -bool true


## Some random UX stuff
# â†’ increase window resize speed for Cocoa applications
defaults write NSGlobalDomain NSWindowResizeTime -float 0.001
# â†’ disable "Are you sure you want to open this application?" dialog
defaults write com.apple.LaunchServices LSQuarantine -bool false
# â†’ disable smart quotes as they're annoying when typing code
defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false
# â†’ disable smart dashes as they're annoying when typing code
defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false



## Kill affected applications                                                  #
for app in "Activity Monitor" "Address Book" "Calendar" "Contacts" "cfprefsd" \
    "Dock" "Finder" "Mail" "Messages" "Photos" "Safari" "SystemUIServer" \
    "Terminal" "iCal"; do
    killall "${app}" &> /dev/null
done

echo "ğŸº Done, please reboot."

